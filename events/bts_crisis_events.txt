namespace = bts

# bts.50X -> Crisis Global Events
# bts.51X -> Crisis Lvl 1 Events
# bts.52X -> Crisis Lvl 2 Events
# bts.53X -> Crisis Lvl 3 Events
# bts.54X -> Crisis Lvl 4 Events
# bts.55X -> Crisis Lvl 5 Events

# DEBUG : Gives Devoured Mind Pop
country_event = {
	id = bts.5000
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		capital_scope = {
			create_pop = {
				species = root
			}
			last_created_pop = {
				bts_effect_devour_mind = {
					CASTER = root
				}
			}
		}
	}
}

# DEBUG : Steal a pop
country_event = {
	id = bts.5001
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		random_country = {
			limit = {
				NOT = {
					is_same_value = root
				}
				any_owned_pop = {
					is_robot_pop = no
				}
			}
			random_owned_pop = {
				limit = {
					is_robot_pop = no
					NOT = { 
						has_trait = bts_trait_crisis_thrall
					}
				}
				bts_effect_devour_mind = {
					CASTER = root
				}
				resettle_pop = {
					pop = this
					planet = root.capital_scope
				}
			}
		}
	}
}

# DEBUG : Gives crisis currency
country_event = {
	id = bts.5002
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		complete_crisis_objective = bts_crisis_obj_debug
	}
}


# Crisis Objective: Performs a Ritual
country_event = {
	id = bts.500
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		complete_crisis_objective = bts_crisis_obj_ritual
	}
}

# Crisis Objective: Devours Mind
country_event = {
	id = bts.501
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		complete_crisis_objective = bts_crisis_obj_devour_mind
	}
}

# Ritual: Mindset Shift
country_event = {
	id = bts.502
	picture = GFX_evt_alien_abduction
	title = bts_ritual_reset_leader
	desc = bts_ritual_reset_leader_effects

	is_triggered_only = yes

	immediate = {
		bts_event_target_list_clear = yes
		every_owned_leader = {
			limit = {
				has_skill > 1
			}
			bts_event_target_list_save = yes
		}
	}

	inline_script = {
		script = bts_option_list_hidden
		ACTION = "leader_event = { id = bts.503 }"
	}

	option = {
		name = OK
		default_hide_option = yes
	}
}

leader_event = {
	id = bts.503
	picture = GFX_evt_alien_abduction
	title = bts_ritual_reset_leader
	desc = bts_ritual_reset_leader_choose_spec

	is_triggered_only = yes

	option = {
		name = official_with_icon
		hidden_effect = {
			bts_reset_leader = { CLASS = official }
		}
	} 
	
	option = {
		name = commander_with_icon
		hidden_effect = {
			bts_reset_leader = { CLASS = commander }
		}
	}

	option = {
		name = scientist_with_icon
		hidden_effect = {
			bts_reset_leader = { CLASS = scientist }
		}
	}
}

# Create Game Country
country_event = {
	id = bts.504
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		create_country = {
			name = "NAME_Creatures_of_the_Shroud"
			type = shroud_spirits
			flag = {
				icon = {
					category = "special"
					file = "the_shroud.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"dark_purple"
					"black"
					"null"
					"null"
				}
			}
		}
		last_created_country = {
			establish_communications_no_message = root
			save_global_event_target_as = bts_shroud_rift_creatures
		}
	}
}

# Kill a fleet
fleet_event = {
	id = bts.505
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		destroy_fleet = this
	}
}

# this = operation; from = target (country)
espionage_operation_event = {
	id = bts.513
	title = operation_bts_crisis_devour_mind_event_title
	desc = operation_bts_crisis_devour_mind_event_desc

	picture = GFX_evt_alien_abduction
	show_sound = event_espionage_concluded
	espionage_operation = yes
	is_triggered_only = yes

	trigger = {
		exists = from
	}

	option = {
		name = OK

		from = {
			random_owned_pop = {
				limit = {
					is_robot_pop = no
					NOT = { 
						has_trait = bts_trait_crisis_thrall
					}
				}
				custom_tooltip = operation_bts_crisis_devour_mind_tooltip_effect
				hidden_effect = {
					bts_effect_devour_mind = {
						CASTER = root.owner
					}
					resettle_pop = {
						pop = this
						planet = root.owner.capital_scope
					}
				}
				
			}
		}

		if = {
			limit = {
				owner = {
					bts_can_use_councilor_power = { COUNCILOR = bts_crisis_councilor_operation }
				}
			}
			from = {
				random_owned_pop = {
					limit = {
						is_robot_pop = no
						NOT = { 
							has_trait = bts_trait_crisis_thrall
						}
					}
					custom_tooltip = operation_bts_crisis_devour_mind_tooltip_effect
					hidden_effect = {
						bts_effect_devour_mind = {
							CASTER = root.owner
						}
						resettle_pop = {
							pop = this
							planet = root.owner.capital_scope
						}
					}
				}
			}
		}
		
	}

	after = {
		spynetwork = {
			add_spy_network_level_on_success_effect = { VALUE = -5 }
		}
		destroy_espionage_operation = this
	}
}

# Devour Mind species rights
country_event = {
	id = bts.523
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_owned_species = {
			has_citizenship_type = {
				type = citizenship_bts_crisis
				country = root
			}
		}
	}

	immediate = {
		random_list = {
			1 = { # 3 pops
				while = {
					count = 3
					random_owned_pop = {
						limit = {
							has_citizenship_type = {
								type = citizenship_bts_crisis
								country = root
							}
						}
						bts_effect_devour_mind = { 
							CASTER = root
						}
					}
				}
			}

			1 = { # 6 pops
				while = {
					count = 6
					random_owned_pop = {
						limit = {
							has_citizenship_type = {
								type = citizenship_bts_crisis
								country = root
							}
						}
						bts_effect_devour_mind = { 
							CASTER = root
						}
					}
				}
			}

			1 = { # 12 pops
				while = {
					count = 12
					random_owned_pop = {
						limit = {
							has_citizenship_type = {
								type = citizenship_bts_crisis
								country = root
							}
						}
						bts_effect_devour_mind = { 
							CASTER = root
						}
					}
				}
			}
		}
	}
}

# country_event = {
# 	id = bts.30
# 	is_triggered_only = yes
# 	hide_window = yes
	
# 	immediate = {
# 		owner_main_species = {
# 			change_species_characteristics = {
# 				remove_trait = bts_trait_crisis_main_1
# 				add_trait = bts_trait_crisis_main_2
# 			}
# 		}
# 	}
# }



