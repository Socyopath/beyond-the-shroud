namespace = bts

country_event = {
	id = bts.200
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		NOT = { has_country_flag = bts_covenant_contact }
		NOT = { has_country_flag = bts_covenant_contact_pending }
		has_patron_relation = { patron = whisperers_in_the_void contact = completed }
	}

	immediate = {
		set_country_flag = bts_covenant_contact_pending
		country_event = {
			id = bts.201
			days = 10
		}
	}

}

country_event = {
	id = bts.201
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = bts_covenant_contact_pending
	}

	option = {
		name = OK

		hidden_effect = {
			revert_accords = whisperers_in_the_void
			replace_patron = {
				new_patron = bts_patron
				replaced_patron = whisperers_in_the_void
			}
			set_patron_first_contact_state = { patron = bts_patron state = completed }
			set_attunement = {
				patron = bts_patron
				value = @attunement_first_accord
			}
			refresh_psionic_aura_type = yes
			# if = {
			# 	limit = { is_corporeal_authority = yes }
			# 	set_psionic_choir_policy = yes
			# }
			set_country_flag = bts_covenant_contact
			remove_country_flag = bts_covenant_contact_pending
		}

	}
}

# Covenant Proposal
inline_script = {
	script = shroud/patron_covenant_proposition_event
	EVENT_ID = bts.205
	FORMED_EVENT_ID = bts.206
	CONFIRM_EVENT_ID = bts.207
	PATRON_TYPE = bts_patron
	CHAIN = "shroud_composer_covenant_chain"
}

# Covenant Formed
inline_script = {
	script = shroud/patron_covenant_formed_event
	EVENT_ID = bts.206
	PICTURE = GFX_evt_shroud_whisperers_in_the_void
	SOUND = event_whisperers_in_the_void
}

# Covenant Confirmation
inline_script = {
	script = shroud/patron_covenant_confirmation_event
	EVENT_ID = bts.207
	PATRON_TYPE = bts_patron
	MARK_TECH = bts_tech_covenant_mark
	TECH_PATRON = bts_patron
	CHAIN = "shroud_whisperers_covenant_chain"
}


# Power 2 Event 
country_event = {
	id = bts.210
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		every_system_with_aura = {
			every_neighbor_system = {
				remove_hyperlane = { from = prev to = this }
				system_event = { 
					id = bts.211
					days = 50
					scopes = { from = prev }
				}
			}
			add_aura_intensity = @accord_aura_intensity_loss
		}
	}
}

system_event = {
	id = bts.211
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		FROM = {
			NOT = { has_hyperlane_to = root }
		}
	}

	immediate = {
		add_hyperlane = { 
			from = FROM 
			to = root 
		}
	}
}