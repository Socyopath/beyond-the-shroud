# decision_bts_shroud_rift_summon_1 = {
# 	sound = event_energy_field
# 	icon = decision_wormhole
#     owned_planets_only = no

# 	resources = {
# 		category = decisions
# 		cost = {
# 			# astral_threads = @decision_bts_zroni_astral_spliting_astral_threads_cost
#             # energy = 100
# 		}
# 	}

# 	potential = {
#         is_planet_class = pc_bts_shroud_rift
# 		exists = solar_system.owner
#         solar_system.owner = {
#             has_crisis_perk = bts_menp_mega_summon_1
#         }
# 	}

#     allow = {
#         custom_tooltip = {
#             fail_text = decision_bts_shroud_rift_summon_cooldown
#             solar_system.owner = {
#                 NOT = {
#                     has_modifier = shroud_cooldown
#                 }
#             }
#         }
#     }

# 	effect = {
#         custom_tooltip = decision_bts_shroud_rift_summon_1_effect
#         solar_system.owner = {
#             add_modifier = {
#                 modifier = "shroud_cooldown"
#                 days = @bts_power_summon_1_shroud_delve_cooldown
#                 time_multiplier = value:scripted_modifier_mult|MODIFIER|shroud_delve_cooldown|
#             }
#             hidden_effect = {
#                 country_event = { id = bts.310 }
#             }
#         }
# 	}
# }

# Rituals
bts_ritual_pop_trade = {
	sound = event_energy_field
	icon = decision_wormhole
    owned_planets_only = no

	potential = {
        is_planet_class = pc_bts_shroud_rift
		exists = from
        from = {
            has_crisis_perk = bts_menp_mega
        }
	}

    allow = {
        bts_crisis_ritual_can_use_cooldown = { RITUAL = bts_ritual_pop_trade }

        if = {
            limit = { 
                from = {
                    bts_can_use_councilor_ultimate_power = { COUNCILOR = bts_crisis_councilor_ritual } 
                }
            }
            bts_crisis_ritual_can_use_cost = {
                COST = @bts_ritual_pop_trade_custom_thrall_cost
            }
        }
        else = {
            bts_crisis_ritual_can_use_cost = {
                COST = @bts_ritual_pop_trade_thrall_cost
            }
        }

    }

	effect = {
        custom_tooltip = bts_ritual_pop_trade_effects

        hidden_effect = {
            from.capital_scope = {
                create_pop = {
                    species = owner_main_species
                }
            }
        }
        if = {
            limit = {
                from = {
                    bts_can_use_councilor_power = { COUNCILOR = bts_crisis_councilor_ritual }
                }
            }
            custom_tooltip = bts_ritual_pop_trade_bonus_effect
            hidden_effect = {
                add_modifier = {
                    modifier = bts_ritual_pop_trade_boost
                    days = @bts_ritual_pop_trade_boost_duration
                }
            }
        }

        if = {
            limit = { 
                from = {
                    bts_can_use_councilor_ultimate_power = { COUNCILOR = bts_crisis_councilor_ritual } 
                }
            }
            bts_crisis_ritual_setup = {
                COST = @bts_ritual_pop_trade_custom_thrall_cost
                RITUAL = bts_ritual_pop_trade
            }
        }
        else = {
            bts_crisis_ritual_setup = {
                COST = @bts_ritual_pop_trade_thrall_cost
                RITUAL = bts_ritual_pop_trade
            }
        }
	}
}

bts_ritual_remove_trait = {
	sound = event_energy_field
	icon = decision_wormhole
    owned_planets_only = no

	potential = {
        is_planet_class = pc_bts_shroud_rift
		exists = from
        from = {
            has_crisis_perk = bts_menp_mega
        }
	}

    allow = {
        bts_crisis_ritual_can_use_cooldown = { RITUAL = bts_ritual_remove_trait }
        bts_crisis_ritual_can_use_cost = {
            COST = @bts_ritual_remove_trait_thrall_cost
        }
        from = {
            any_owned_leader = {
                num_leader_traits = {
                    value > 0
                    negative = yes
                }
            }
        }
    }

	effect = {
        custom_tooltip = bts_ritual_remove_trait_effects
        bts_crisis_ritual_setup = {
            COST = @bts_ritual_remove_trait_thrall_cost
            RITUAL = bts_ritual_remove_trait
        }

        hidden_effect = {
            from = {
                random_owned_leader = {
                    limit = {
                        num_leader_traits = {
                            value > 0
                            negative = yes
                        }
                    }
                    remove_trait = all_negative
                }
            }
        }

	}
}

bts_ritual_reset_leader = {
	sound = event_energy_field
	icon = decision_wormhole
    owned_planets_only = no

	potential = {
        is_planet_class = pc_bts_shroud_rift
		exists = from
        from = {
            has_crisis_perk = bts_menp_mega
        }
	}

    allow = {
        bts_crisis_ritual_can_use_cooldown = { RITUAL = bts_ritual_reset_leader }
        bts_crisis_ritual_can_use_cost = {
            COST = @bts_ritual_reset_leader_thrall_cost
        }
    }

	effect = {
        custom_tooltip = bts_ritual_reset_leader_effects
        bts_crisis_ritual_setup = {
            COST = @bts_ritual_reset_leader_thrall_cost
            RITUAL = bts_ritual_reset_leader
        }

        hidden_effect = {
            from = {
                country_event = { id = bts.502 }
            }
        }

	}
}


bts_ritual_harvest = {
    sound = event_energy_field
	icon = decision_wormhole
    owned_planets_only = no

	potential = {
        is_planet_class = pc_bts_shroud_rift
		exists = from
        from = {
            has_crisis_perk = bts_menp_energy
        }
	}

    allow = {
        bts_crisis_ritual_can_use_cooldown = { RITUAL = bts_ritual_harvest }
        bts_crisis_ritual_can_use_cost = {
            COST = @bts_ritual_harvest_thrall_cost
        }
    }

	effect = {
        custom_tooltip = bts_ritual_harvest_effects
        bts_crisis_ritual_setup = {
            COST = @bts_ritual_harvest_thrall_cost
            RITUAL = bts_ritual_harvest
        }
        hidden_effect = {
            random_list = {
                1 = {
                    bts_add_random_deposit = {
                        BASIC_COUNT = @bts_ritual_harvest_high_basic
                        TECH_COUNT = @bts_ritual_harvest_high_tech
                        SR_COUNT = @bts_ritual_harvest_high_sr
                    }
                }
                2 = {
                    bts_add_random_deposit = {
                        BASIC_COUNT = @bts_ritual_harvest_medium_basic
                        TECH_COUNT = @bts_ritual_harvest_medium_tech
                        SR_COUNT = @bts_ritual_harvest_medium_sr
                    }
                }
                3 = {
                    bts_add_random_deposit = {
                        BASIC_COUNT = @bts_ritual_harvest_low_basic
                        TECH_COUNT = @bts_ritual_harvest_low_tech
                        SR_COUNT = @bts_ritual_harvest_low_sr
                    }
                }
            }
        }
        hidden_effect = {
            if = {
                limit = {
                    NOT = { exists = event_target:bts_shroud_rift_creatures }
                }
                from = {
                    country_event = { 
                        id = bts.504
                    }
                }
            }
            random_list = {
                10 = {
                    create_fleet = {
                        name = "NAME_Shroud_Manifestation"
                        settings = {
                            spawn_debris = no
                            is_boss = yes
                        }
                        effect = {
                            set_owner = event_target:bts_shroud_rift_creatures
                            create_ship = {
                                name = "NAME_Fragment"
                                design = "NAME_Shroud_Manifestation"
                            }
                            set_location = prev
                            set_fleet_stance = aggressive
                            set_aggro_range_measure_from = return_point
                            set_aggro_range = 3000
                        }
                    }
                    last_created_fleet = {
                        fleet_event = { id = bts.505 days = @bts_ritual_harvest_days_before_invasion_end }
                    }
                }
                30 = {
                    create_fleet = {
                        name = "NAME_Corrupted_Avatar"
                        settings = {
                            spawn_debris = no
                            is_boss = yes
                        }
                        effect = {
                            set_owner = event_target:bts_shroud_rift_creatures
                            create_ship = {
                                name = "NAME_Corrupted_Avatar"
                                design = "NAME_Corrupted_Avatar"
                            }
                            set_location = prev
                            set_fleet_stance = aggressive
                            set_aggro_range_measure_from = return_point
                            set_aggro_range = 300
                        }
                    }
                    last_created_fleet = {
                        fleet_event = { id = bts.505 days = @bts_ritual_harvest_days_before_invasion_end }
                    }
                }
                60 = {
                    # Nothing 
                }
            }
	    }   
    }
}

bts_ritual_dreamlike = {
	sound = event_energy_field
	icon = decision_wormhole
    owned_planets_only = no

	potential = {
        is_planet_class = pc_bts_shroud_rift
		exists = from
        from = {
            has_crisis_perk = bts_menp_war_terror
        }
	}

    allow = {
        bts_crisis_ritual_can_use_cooldown = { RITUAL = bts_ritual_dreamlike }
        bts_crisis_ritual_can_use_cost = {
            COST = @bts_ritual_dreamlike_thrall_cost
        }
    }

	effect = {
        custom_tooltip = bts_ritual_dreamlike_effects
        bts_crisis_ritual_setup = {
            COST = @bts_ritual_dreamlike_thrall_cost
            RITUAL = bts_ritual_dreamlike
        }

        hidden_effect = {
            create_fleet = {
                name = "bts_ship_crisis_dreamlike"
                settings = {
                    can_upgrade = no
                    can_change_composition = no
                    can_change_leader = no
                    uses_naval_capacity = no
                    spawn_debris = no
                }
                effect = {
                    set_owner = from
                    create_ship = {
                        name = "bts_ship_crisis_dreamlike"
                        design = "bts_crisis_dreamlike_design"
                    }
                    set_location = root
                }
            }
        }

	}
}

bts_ritual_war_terror = {
	sound = event_energy_field
	icon = decision_wormhole
    owned_planets_only = no

	potential = {
        is_planet_class = pc_bts_shroud_rift
		exists = from
        from = {
            has_crisis_perk = bts_menp_war_terror
        }
	}

    allow = {
        bts_crisis_ritual_can_use_cooldown = { RITUAL = bts_ritual_war_terror }
        bts_crisis_ritual_can_use_cost = {
            COST = @bts_ritual_war_terror_thrall_cost
        }

        from = {
            is_at_war = yes
        }
    }

	effect = {
        custom_tooltip = bts_ritual_war_terror_effects
        bts_crisis_ritual_setup = {
            COST = @bts_ritual_war_terror_thrall_cost
            RITUAL = bts_ritual_war_terror
        }

        hidden_effect = {
            from = {
                every_war = {
                    every_war_participant = {
                        limit = {
                            NOT = { is_same_value = prevprev }
                            is_hostile = prevprev
                        }
                        add_modifier = {
                            modifier = bts_crisis_war_exhaust
                            days = @bts_ritual_war_terror_duration
                        }
                    }
                }
            }
        }

	}
}
# decision_bts_shroud_rift_summon_4 = {
# 	sound = event_energy_field
# 	icon = decision_wormhole
#     owned_planets_only = no

# 	resources = {
# 		category = decisions
# 		cost = {
# 			# astral_threads = @decision_bts_zroni_astral_spliting_astral_threads_cost
#             # energy = 100
# 		}
# 	}

# 	potential = {
#         is_planet_class = pc_bts_shroud_rift
# 		exists = solar_system.owner
#         solar_system.owner = {
#             has_crisis_perk = bts_menp_mega_summon_4
#         }
# 	}

#     allow = {
#         custom_tooltip = {
#             fail_text = decision_bts_shroud_rift_summon_cooldown
#             solar_system.owner = {
#                 NOT = {
#                     has_modifier = shroud_cooldown
#                 }
#             }
#         }
#         custom_tooltip = { 
#             fail_text = decision_bts_shroud_rift_summon_4_invalid_number 
#             count_owned_ship = { 
#                 count < @bts_power_summon_4_max_number 
#                 limit = { is_ship_size = warped_consciousness } 
#             } 
#         }
#     }

# 	effect = {
#         custom_tooltip = decision_bts_shroud_rift_summon_4_effect
#         solar_system.owner = {
#             add_modifier = {
#                 modifier = "shroud_cooldown"
#                 days = @bts_power_summon_4_shroud_delve_cooldown
#                 time_multiplier = value:scripted_modifier_mult|MODIFIER|shroud_delve_cooldown|
#             }
#             hidden_effect = {
#                 country_event = { id = bts.340 }
#             }
#         }
# 	}
# }
